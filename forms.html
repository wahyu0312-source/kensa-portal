<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>出荷検査成績書 - 品質管理生産技術</title>
  <style>
    :root{
      --bg:#f5f7fb; --card:#ffffff; --text:#0f172a; --muted:#64748b; --border:#e5e7eb;
      --accent:#2563eb; --shadow:0 10px 30px rgba(2,8,23,.06);
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--text);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
    .container{max-width:1080px;margin:0 auto;padding:24px}
    .header{display:flex;align-items:center;justify-content:space-between}
    .brand{display:flex;align-items:center;gap:12px}
    .brand img{width:42px;height:42px;border-radius:50%;background:#fff;padding:6px;box-shadow:var(--shadow)}
    .brand .title{font-weight:800;letter-spacing:.2px;font-size:1.6rem}
    .brand .subtitle{color:var(--muted);font-weight:600;font-size:.9rem}
    .nav a{color:var(--muted);text-decoration:none;margin-left:18px;font-weight:600}
    .nav a:hover{color:var(--accent)}
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;
      padding:18px;box-shadow:var(--shadow);margin-top:20px}
    .card h1{margin:0;font-size:1.4rem}
    .table-wrap{overflow:auto;border:1px solid var(--border);border-radius:12px;margin-top:14px;background:#fff}
    table{width:100%;border-collapse:collapse}
    th,td{border-bottom:1px solid var(--border);padding:10px 12px;text-align:left;white-space:nowrap}
    th{color:var(--muted);font-weight:700;background:#f8fafc;position:sticky;top:0}
    tr:hover td{background:#f9fafb}
    .badge{border:1px solid var(--border);padding:2px 8px;border-radius:999px;background:#fff}
    .empty{color:var(--muted);padding:14px;text-align:center}
    .footer{color:var(--muted);text-align:center;padding:30px 0;display:flex;gap:8px;justify-content:center;flex-wrap:wrap}
    .footer .sep{opacity:.4}
  </style>
</head>
<body>
  <header class="container header">
    <div class="brand">
      <img src="https://upload.wikimedia.org/wikipedia/commons/4/44/Tokyo_Seimitsu_logo.png" alt="Logo">
      <div>
        <div class="title">品質管理生産技術</div>
        <div class="subtitle">東京精密発條株式会社</div>
      </div>
    </div>
    <nav class="nav">
      <a href="./index.html">ホーム</a>
      <a href="./forms.html"><strong>出荷検査成績書</strong></a>
    </nav>
  </header>

  <main class="container">
    <section class="card">
      <h1>出荷検査成績書 一覧</h1>
      <p class="muted" style="margin:0">Google スプレッドシートから自動更新</p>
      <div class="table-wrap">
        <table>
          <thead><tr id="thead-row"></tr></thead>
          <tbody id="tbody"></tbody>
        </table>
        <div id="empty" class="empty" style="display:none">データがありません</div>
      </div>
    </section>
  </main>

  <footer class="container footer">
    <span>&copy; <span id="year"></span> 東京精密発條株式会社</span>
    <span class="sep">•</span>
    <span>Design by ワーユ</span>
  </footer>

  <script>
    document.getElementById("year").textContent = new Date().getFullYear();

    // ====== Spreadsheet Config ======
    const SHEET_ID = "1lYl7oYk6atnm3KqC6VwufARX3ooRyJ2VmC_xYFb4-OE";
    const SHEET_NAME = "最新情報250822"; // ganti sesuai TAB di Google Sheets
    const CSV_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv&sheet=${SHEET_NAME}`;

    // ====== CSV Parse ======
    function parseCSV(text){
      const rows=[], re=/\s*("(?:[^"]|"")*"|[^,]*)\s*(,|\n|$)/g;
      let m, row=[]; text=text.replace(/\r\n?/g,"\n");
      for (let i=0;i<text.length;){
        re.lastIndex=i; m=re.exec(text); if(!m) break;
        let cell=m[1]; if(cell.startsWith('"')) cell=cell.slice(1,-1).replace(/""/g,'"');
        row.push(cell); i=re.lastIndex;
        if(m[2]==="\n"||m[2]===""){ rows.push(row); row=[]; }
      }
      return rows.filter(r=>r.length && r.join("").trim()!=="");
    }

    function renderTable(header, rows){
      const tr=document.getElementById("thead-row");
      tr.innerHTML = header.map(c=>`<th>${c}</th>`).join("");
      const tb=document.getElementById("tbody");
      tb.innerHTML="";
      rows.forEach(r=>{
        const tds=r.map(val=>`<td>${val}</td>`).join("");
        tb.insertAdjacentHTML("beforeend", `<tr>${tds}</tr>`);
      });
    }

    async function loadCSV(){
      try{
        const bust = (CSV_URL.includes("?")?"&":"?") + "t=" + Date.now();
        const res  = await fetch(CSV_URL + bust, { cache:"no-store" });
        if(!res.ok){ showEmpty("取得エラー"); return; }
        const text = await res.text();
        const arr  = parseCSV(text);
        if (!arr.length){ showEmpty("データがありません"); return; }

        const header = arr[0], rows = arr.slice(1);
        if (!rows.length){ showEmpty("データがありません"); return; }
        renderTable(header, rows);
      }catch(e){
        console.error(e);
        showEmpty("取得エラー");
      }
    }

    function showEmpty(msg){
      document.getElementById("tbody").innerHTML = "";
      const el = document.getElementById("empty");
      el.textContent = msg;
      el.style.display = "block";
    }

    window.addEventListener("DOMContentLoaded", loadCSV);
  </script>
</body>
</html>
