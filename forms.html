<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>出荷検査成績書</title>
  <style>
    :root{
      --ink:#0f172a; --muted:#64748b; --border:#e5e7eb;
      --bg1:#eef4ff; --bg2:#f8fafc; --card:#fff; --accent:#2563eb;
      --ok:#16a34a; --ng:#b91c1c;
      --radius-lg:24px; --radius-sm:10px;
      --shadow:0 10px 30px rgba(0,0,0,.06);
    }
    *{box-sizing:border-box}
    html,body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans JP","Yu Gothic",sans-serif;color:var(--ink);background:linear-gradient(120deg,var(--bg1),var(--bg2))}
    a{color:inherit}

    header{position:sticky;top:0;background:#ffffffcc;backdrop-filter:blur(8px);border-bottom:1px solid var(--border);z-index:20}
    .container{max-width:1200px;margin:0 auto;padding:12px 20px}
    .row{display:flex;align-items:center;justify-content:space-between;gap:16px}
    .brand{display:flex;align-items:center;gap:12px;min-height:44px}
    .brand img.logo{height:38px;width:auto;display:block}
    .brand-title{display:flex;flex-direction:column}
    .brand-title small{font-size:12px;color:var(--muted)}

    nav{display:flex;align-items:center;gap:14px}
    nav a{color:var(--accent);font-weight:700;text-decoration:none;padding:6px 0}
    nav a:hover{text-decoration:underline}
    .btn-chart{display:inline-block;padding:9px 14px;border-radius:9999px;background:var(--accent);color:#fff !important;border:1px solid #1e4fdc;box-shadow:0 6px 16px rgba(37,99,235,.25);text-decoration:none}
    .btn-chart:hover{filter:brightness(1.05);text-decoration:none}

    main{max-width:1200px;margin:24px auto;padding:0 20px 56px}
    h1{margin:0 0 16px 0}

    .card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius-lg);padding:24px;box-shadow:var(--shadow)}
    .lock{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .lock input{padding:10px 12px;border:1px solid var(--border);border-radius:var(--radius-sm);min-width:240px}
    .lock button{padding:10px 12px;border:1px solid var(--border);border-radius:var(--radius-sm);background:#fff;cursor:pointer}
    .lock .msg{min-width:80px;font-weight:600}

    .searchbar{display:flex;gap:8px;align-items:center}
    .searchbar input{flex:1;padding:12px;border:2px solid #0b12221a;border-radius:9999px;outline:none}
    .searchbar button{padding:10px 12px;border:1px solid var(--border);border-radius:var(--radius-sm);background:#fff;cursor:pointer}
    .hidden{display:none}

    .folder{background:#fff;border:1px solid var(--border);border-radius:12px;margin-bottom:12px;overflow:hidden}
    .folder-head{padding:14px 16px;cursor:pointer;display:flex;justify-content:space-between;align-items:center;background:#f9fafb;font-weight:700}
    .folder-body{display:none;padding:12px}
    .subfolder{margin-bottom:10px}
    .subfolder strong{display:block;margin-bottom:6px}
    .link{display:block;padding:10px 12px;border:1px solid var(--border);border-radius:8px;margin-bottom:6px;text-decoration:none;color:var(--ink);background:#fff}
    .link span{display:block;font-size:12px;color:var(--muted)}
    .link:hover{background:#f0f9ff;border-color:#93c5fd}

    footer{text-align:center;color:var(--muted);padding:20px}

    .marquee-bottom {position: fixed;bottom: 0;left: 0;width: 100%;overflow: hidden;white-space: nowrap;background: #2563eb;color: #fff;padding: 8px 0;z-index: 9999}
    .marquee-bottom span {display: inline-block;padding-left: 100%;animation: marquee-bottom 15s linear infinite;font-weight: bold;font-size: 14px}
    @keyframes marquee-bottom {0%{transform: translateX(0)}100%{transform: translateX(-100%)}}

    @media (max-width: 640px){
      .brand img.logo{height:30px}
      nav{gap:10px}
      .btn-chart{padding:8px 12px}
    }
  </style>
</head>
<body>
<header>
  <div class="container row">
    <div class="brand">
      <img src="tsh.png" alt="東京精密発條 ロゴ" class="logo" onerror="this.style.display='none';this.nextElementSibling.style.display='inline-block'">
      <svg viewBox="0 0 64 64" aria-hidden="true" style="display:none;width:38px;height:38px">
        <circle cx="32" cy="32" r="30" fill="#2563eb22"/>
        <path d="M12 34h40M12 30h40M20 18h24v6H20zM20 40h24v6H20z" stroke="#2563eb" stroke-width="2" fill="none" stroke-linecap="round"/>
        <circle cx="20" cy="32" r="3" fill="#2563eb"/>
        <circle cx="44" cy="32" r="3" fill="#2563eb"/>
      </svg>
      <div class="brand-title">
        <strong>品質管理生産技術</strong>
        <small>東京精密発條株式会社</small>
      </div>
    </div>
    <nav>
      <a href="./index.html">ホーム</a>
      <a href="./forms.html"><strong>出荷検査成績書</strong></a>
      <a href="./sagyoutejunsho.html">作業手順書</a>
      <a class="btn-chart" href="./charts.html" aria-label="チャートページを開く">チャート</a>
    </nav>
  </div>
</header>

<main>
  <h1>出荷検査成績書フォルダ</h1>

  <!-- Password -->
  <div id="lock" class="card">
    <div class="lock">
      <input id="pwd" type="password" placeholder="パスワード" autocomplete="current-password">
      <button id="btnToggle" type="button">表示</button>
      <button id="btnUnlock" type="button">確定</button>
      <span id="msg" class="msg"></span>
    </div>
  </div>

  <!-- Search -->
  <div id="searchWrap" class="card hidden" style="margin-top:12px;">
    <div class="searchbar">
      <input id="q" type="search" placeholder="検索（顧客名／サブフォルダ／フォーム名／説明）">
      <button id="btnSearch" type="button">検索</button>
      <button id="btnReset"  type="button">リセット</button>
      <span id="hit" style="color:#64748b"></span>
    </div>
  </div>

  <div id="folders" class="hidden"></div>
</main>

<footer>&copy; <span id="year"></span> wahyu</footer>

<script>
  // ---------- Helpers ----------
  function getJSON(key, fallback){
    try {
      const val = localStorage.getItem(key);
      if (val === null || val === '') return fallback;
      return JSON.parse(val);
    } catch (e){
      // bersihkan jika rusak
      localStorage.removeItem(key);
      return fallback;
    }
  }

  // ---------- Constants & Data ----------
  document.getElementById('year').textContent = new Date().getFullYear();
  const PASSWORD = "kensa2025"; // ganti jika perlu

  const DATA = [
    {customer:"オークマ株式会社",folders:[
      {name:"Y軸",links:[
        {label:"2825-20",desc:"MB46V Y軸",url:"https://wahyu0312-source.github.io/okuma46/"},
        {label:"2035-20",desc:"MB56V Y軸",url:"https://wahyu0312-source.github.io/mb56/"},
        {label:"2023-20",desc:"MB66V Y軸",url:"https://wahyu0312-source.github.io/mb66v/"}
      ]},
      {name:"X軸",links:[
        {label:"330380V",desc:"MB80V-3303",url:"https://wahyu0312-source.github.io/330380v/"},
        {label:"330580V",desc:"MB80V-33035",url:"https://wahyu0312-source.github.io/330580v/"},
        {label:"2742-20",desc:"MU6300V-2742",url:"https://wahyu0312-source.github.io/2742-20/"}
      ]}
    ]},
    {customer:"中村留株式会社",folders:[
      {name:"WYプロテクター",links:[
        {label:"3596-70",desc:"WY-150V X3 プロテクター",url:"https://wahyu0312-source.github.io/359670X3150V/"}
      ]},
      {name:"NTY3プロテクター",links:[
        {label:"3555-71",desc:"NTY3-100V X2 プロテクター",url:"https://wahyu0312-source.github.io/3555-71tomei/"}
      ]}
    ]}
  ];

  // ---------- Elements ----------
  const elLock = document.getElementById('lock');
  const elFolders = document.getElementById('folders');
  const elSearchWrap = document.getElementById('searchWrap');
  const elPwd = document.getElementById('pwd');
  const elMsg = document.getElementById('msg');
  const elQ = document.getElementById('q');
  const elHit = document.getElementById('hit');
  const btnSearch = document.getElementById('btnSearch');
  const btnReset = document.getElementById('btnReset');
  const btnToggle = document.getElementById('btnToggle');
  const btnUnlock = document.getElementById('btnUnlock');

  // ---------- State ----------
  let lastQuery = "";
  let openCustomers = new Set();

  // ---------- Init ----------
  (function init(){
    // Enter handlers
    elPwd.addEventListener('keydown', e => { if (e.key === "Enter") unlock(); });
    elQ.addEventListener('keydown',  e => { if (e.key === "Enter") search(); });

    // Buttons
    btnUnlock.addEventListener('click', unlock);
    btnSearch.addEventListener('click', search);
    btnReset.addEventListener('click', resetView);

    // 表示/非表示 toggle
    btnToggle.addEventListener('click', () => {
      const show = elPwd.type === 'password';
      elPwd.type = show ? 'text' : 'password';
      btnToggle.textContent = show ? '非表示' : '表示';
    });

    // Live check password
    elPwd.addEventListener('input', () => {
      if (!elPwd.value) { elMsg.textContent = ''; return; }
      const ok = elPwd.value === PASSWORD;
      elMsg.textContent = ok ? '✓ 正しい' : '× 違います';
      elMsg.style.color = ok ? 'var(--ok)' : 'var(--ng)';
    });

    // Restore state (aman dari data rusak)
    const unlocked = localStorage.getItem('kensa_unlocked') === '1';
    const savedQuery = localStorage.getItem('kensa_query') || "";
    const savedOpen = getJSON('kensa_open', []);

    if (unlocked) {
      elLock.classList.add('hidden');
      elFolders.classList.remove('hidden');
      elSearchWrap.classList.remove('hidden');

      elQ.value = savedQuery;
      lastQuery = (savedQuery || "").trim().toLowerCase();
      openCustomers = new Set(savedOpen);
      render(DATA);
    }

    // Info di console untuk debugging
    console.info('Kensa portal loaded. If the buttons don’t work, clear site data: localStorage keys kensa_*.');
  })();

  // ---------- Actions ----------
  function unlock(){
    const v = elPwd.value;
    if (v !== PASSWORD) { elMsg.textContent = '× 違います'; elMsg.style.color = 'var(--ng)'; return; }
    elMsg.textContent = '✓ 正しい'; elMsg.style.color = 'var(--ok)';
    elLock.classList.add('hidden');
    elFolders.classList.remove('hidden');
    elSearchWrap.classList.remove('hidden');
    localStorage.setItem('kensa_unlocked','1');
    render(DATA);
  }

  function search(){
    lastQuery = (elQ.value || "").trim().toLowerCase();
    localStorage.setItem('kensa_query', elQ.value || "");
    openCustomers.clear();
    render(DATA);
  }

  function resetView(){
    elQ.value = "";
    lastQuery = "";
    openCustomers.clear();
    localStorage.removeItem('kensa_query');
    localStorage.removeItem('kensa_open');
    render(DATA);
    [...document.querySelectorAll('.folder-body')].forEach(b => b.style.display = 'none');
  }

  function render(src){
    elFolders.innerHTML = "";
    let hits = 0;

    src.forEach(c=>{
      const wrap = document.createElement('div');
      wrap.className = "folder";

      const head = document.createElement('div');
      head.className = "folder-head";
      head.textContent = c.customer;

      const body = document.createElement('div');
      body.className = "folder-body";

      let customerHasHit = false;

      c.folders.forEach(sf=>{
        const sfDiv = document.createElement('div');
        sfDiv.className = "subfolder";
        sfDiv.innerHTML = `<strong>${sf.name}</strong>`;

        sf.links.forEach(l=>{
          const hay = `${c.customer} ${sf.name} ${l.label} ${l.desc}`.toLowerCase();
          if (lastQuery && !hay.includes(lastQuery)) return;

          const a = document.createElement('a');
          a.className = "link";
          a.href = l.url;
          a.target = "_blank";
          a.rel = "noopener noreferrer";
          a.innerHTML = `${l.label}<span>${l.desc || ""}</span>`;

          a.addEventListener('click', (e) => {
            if (!l.url || l.url === '#') {
              e.preventDefault();
              alert('リンク未設定です。正しいURLを入力してください。');
            }
          });

          sfDiv.appendChild(a);
          hits++; customerHasHit = true;
        });

        if (sfDiv.querySelector('.link')) body.appendChild(sfDiv);
      });

      const shouldOpen = lastQuery ? customerHasHit : openCustomers.has(c.customer);
      body.style.display = shouldOpen ? 'block' : 'none';
      if (shouldOpen && !lastQuery) openCustomers.add(c.customer);

      head.addEventListener('click', ()=>{
        const nowOpen = body.style.display === 'block';
        body.style.display = nowOpen ? 'none' : 'block';
        if (!lastQuery) {
          if (nowOpen) openCustomers.delete(c.customer);
          else openCustomers.add(c.customer);
          localStorage.setItem('kensa_open', JSON.stringify([...openCustomers]));
        }
      });

      if (body.children.length > 0){
        wrap.appendChild(head);
        wrap.appendChild(body);
        elFolders.appendChild(wrap);
      }
    });

    elHit.textContent = hits ? `ヒット: ${hits}` : "該当なし";

    if (!lastQuery) {
      [...elFolders.querySelectorAll('.folder-body')].forEach(b => b.style.display = 'none');
    }
  }
</script>

<div class="marquee-bottom">
  <span>⚙️ 品質管理生産技術ポータルへようこそ ｜ 本日も安全第一でお願いします ｜ 水分補給して下さいお願い致します</span>
</div>
</body>
</html>

