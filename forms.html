<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>出荷検査成績書</title>
  <style>
    :root{
      --ink:#0f172a; --muted:#64748b; --border:#e5e7eb;
      --bg1:#eef4ff; --bg2:#f8fafc; --card:#fff; --accent:#2563eb;
      --ok:#16a34a; --ng:#b91c1c;
      --radius-lg:24px; --radius-sm:10px;
      --shadow:0 10px 30px rgba(0,0,0,.06);
    }
    *{box-sizing:border-box}
    html,body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans JP","Yu Gothic",sans-serif;color:var(--ink);background:linear-gradient(120deg,var(--bg1),var(--bg2))}
    a{color:inherit}
    header{position:sticky;top:0;background:#ffffffcc;backdrop-filter:blur(8px);border-bottom:1px solid var(--border)}
    .container{max-width:1200px;margin:0 auto;padding:12px 20px}
    .row{display:flex;align-items:center;justify-content:space-between;gap:16px}
    .brand{display:flex;align-items:center;gap:10px}
    .brand svg{width:38px;height:38px}
    .brand-title{display:flex;flex-direction:column}
    nav a{margin-left:20px;color:var(--accent);font-weight:700;text-decoration:none}
    nav a:hover{text-decoration:underline}

    main{max-width:1200px;margin:24px auto;padding:0 20px}
    h1{margin:0 0 16px 0}

    .card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius-lg);padding:24px;box-shadow:var(--shadow)}
    .lock{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .lock input{padding:10px 12px;border:1px solid var(--border);border-radius:var(--radius-sm);min-width:240px}
    .lock button{padding:10px 12px;border:1px solid var(--border);border-radius:var(--radius-sm);background:#fff;cursor:pointer}
    .lock .msg{min-width:80px;font-weight:600}

    .searchbar{display:flex;gap:8px;align-items:center}
    .searchbar input{flex:1;padding:12px;border:2px solid #0b12221a;border-radius:9999px;outline:none}
    .searchbar button{padding:10px 12px;border:1px solid var(--border);border-radius:var(--radius-sm);background:#fff;cursor:pointer}
    .hidden{display:none}

    .folder{background:#fff;border:1px solid var(--border);border-radius:12px;margin-bottom:12px;overflow:hidden}
    .folder-head{padding:14px 16px;cursor:pointer;display:flex;justify-content:space-between;align-items:center;background:#f9fafb;font-weight:700}
    .folder-body{display:none;padding:12px}
    .subfolder{margin-bottom:10px}
    .subfolder strong{display:block;margin-bottom:6px}
    .link{display:block;padding:10px 12px;border:1px solid var(--border);border-radius:8px;margin-bottom:6px;text-decoration:none;color:var(--ink);background:#fff}
    .link span{display:block;font-size:12px;color:var(--muted)}
    .link:hover{background:#f0f9ff;border-color:#93c5fd}

    footer{text-align:center;color:var(--muted);padding:20px}
  </style>
</head>
<body>
<header>
  <div class="container row">
    <div class="brand">
      <svg viewBox="0 0 64 64" aria-hidden="true">
        <circle cx="32" cy="32" r="30" fill="#2563eb22"/>
        <path d="M12 34h40M12 30h40M20 18h24v6H20zM20 40h24v6H20z" stroke="#2563eb" stroke-width="2" fill="none" stroke-linecap="round"/>
        <circle cx="20" cy="32" r="3" fill="#2563eb"/>
        <circle cx="44" cy="32" r="3" fill="#2563eb"/>
      </svg>
      <div class="brand-title">
        <strong>品質管理生産技術</strong>
        <span style="font-size:12px;color:var(--muted)">東京精密発條株式会社</span>
      </div>
    </div>
    <nav>
      <a href="./index.html">ホーム</a>
      <a href="./forms.html"><strong>出荷検査成績書</strong></a>
      <a href="./sagyoutejunsho.html">作業手順書</a>
    </nav>
  </div>
</header>

<main>
  <h1>出荷検査成績書フォルダ</h1>

  <!-- Password -->
  <div id="lock" class="card">
    <div class="lock">
      <input id="pwd" type="password" placeholder="パスワード">
      <button id="btnToggle">表示</button>
      <button id="btnUnlock">確定</button>
      <span id="msg" class="msg"></span>
    </div>
  </div>

  <!-- Search -->
  <div id="searchWrap" class="card hidden" style="margin-top:12px;">
    <div class="searchbar">
      <input id="q" type="search" placeholder="検索（顧客名／サブフォルダ／フォーム名／説明）">
      <button id="btnSearch">検索</button>
      <button id="btnReset">リセット</button>
      <span id="hit" style="color:#64748b"></span>
    </div>
  </div>

  <div id="folders" class="hidden"></div>
</main>

<footer>&copy; <span id="year"></span> wahyu</footer>

<script>
  // --------- Constants & Demo Data ----------
  document.getElementById('year').textContent = new Date().getFullYear();
  const PASSWORD = "kensa2025";

  const DATA = [
    {customer:"オークマ",folders:[
      {name:"Y軸",links:[
        {label:"2825-20",desc:"MB46V Y軸",url:"https://wahyu0312-source.github.io/okuma46/"},
        {label:"2035-20",desc:"MB56V Y軸",url:"https://wahyu0312-source.github.io/mb56/"},
        {label:"2023-20",desc:"MB66V Y軸",url:"https://wahyu0312-source.github.io/mb66v/"}
      ]},
      {name:"X軸",links:[
        {label:"330380V",desc:"MB80V-3303",url:"https://wahyu0312-source.github.io/330380v/"},
        {label:"330580V",desc:"MB80V-33035",url:"https://wahyu0312-source.github.io/330580v/"}
      ]}
    ]},
    {customer:"山崎マザック",folders:[
      {name:"Z軸",links:[
        {label:"MB 66V",desc:"量産品 Z軸ガイド",url:"#"} // contoh belum di-set
      ]}
    ]}
  ];

  // --------- Elements ----------
  const elLock = document.getElementById('lock');
  const elFolders = document.getElementById('folders');
  const elSearchWrap = document.getElementById('searchWrap');
  const elPwd = document.getElementById('pwd');
  const elMsg = document.getElementById('msg');
  const elQ = document.getElementById('q');
  const elHit = document.getElementById('hit');
  const btnSearch = document.getElementById('btnSearch');
  const btnReset = document.getElementById('btnReset');
  const btnToggle = document.getElementById('btnToggle');
  const btnUnlock = document.getElementById('btnUnlock');

  // --------- State ----------
  let lastQuery = "";
  let openCustomers = new Set(); // simpan folder customer yang terbuka

  // --------- Init ----------
  document.addEventListener('DOMContentLoaded', () => {
    // Enter handlers
    elPwd.addEventListener('keydown', e => { if (e.key === "Enter") unlock(); });
    elQ.addEventListener('keydown',  e => { if (e.key === "Enter") search(); });

    // Buttons
    btnUnlock.addEventListener('click', unlock);
    btnSearch.addEventListener('click', search);
    btnReset.addEventListener('click', resetView);

    // 表示/非表示 toggle (opsional)
    btnToggle.addEventListener('click', () => {
      const show = elPwd.type === 'password';
      elPwd.type = show ? 'text' : 'password';
      btnToggle.textContent = show ? '非表示' : '表示';
    });

    // Live check password (opsional)
    elPwd.addEventListener('input', () => {
      if (!elPwd.value) { elMsg.textContent = ''; return; }
      const ok = elPwd.value === PASSWORD;
      elMsg.textContent = ok ? '✓ 正しい' : '× 違います';
      elMsg.style.color = ok ? 'var(--ok)' : 'var(--ng)';
    });

    // Restore state
    const unlocked = localStorage.getItem('kensa_unlocked') === '1';
    const savedQuery = localStorage.getItem('kensa_query') || "";
    const savedOpen = JSON.parse(localStorage.getItem('kensa_open') || "[]");

    if (unlocked) {
      elLock.classList.add('hidden');
      elFolders.classList.remove('hidden');
      elSearchWrap.classList.remove('hidden');

      elQ.value = savedQuery;
      lastQuery = (savedQuery || "").trim().toLowerCase();
      openCustomers = new Set(savedOpen);
      render(DATA);
    }
  });

  // --------- Actions ----------
  function unlock(){
    const v = elPwd.value;
    if (v !== PASSWORD) { elMsg.textContent = '× 違います'; elMsg.style.color = 'var(--ng)'; return; }
    elMsg.textContent = '✓ 正しい'; elMsg.style.color = 'var(--ok)';
    elLock.classList.add('hidden');
    elFolders.classList.remove('hidden');
    elSearchWrap.classList.remove('hidden');
    localStorage.setItem('kensa_unlocked','1');
    render(DATA);
  }

  function search(){
    lastQuery = (elQ.value || "").trim().toLowerCase();
    localStorage.setItem('kensa_query', elQ.value || "");
    // Saat mencari, kita tidak simpan open/close manual. Otomatis buka customer yang punya hasil.
    openCustomers.clear();
    render(DATA);
  }

  function resetView(){
    // Kembalikan ke tampilan awal
    elQ.value = "";
    lastQuery = "";
    openCustomers.clear();
    localStorage.removeItem('kensa_query');
    localStorage.removeItem('kensa_open');
    render(DATA);
    // Pastikan semua folder tertutup (view awal)
    [...document.querySelectorAll('.folder-body')].forEach(b => b.style.display = 'none');
  }

  function render(src){
    elFolders.innerHTML = "";
    let hits = 0;

    src.forEach(c=>{
      const wrap = document.createElement('div');
      wrap.className = "folder";

      const head = document.createElement('div');
      head.className = "folder-head";
      head.textContent = c.customer;

      const body = document.createElement('div');
      body.className = "folder-body";

      let customerHasHit = false;

      c.folders.forEach(sf=>{
        const sfDiv = document.createElement('div');
        sfDiv.className = "subfolder";
        sfDiv.innerHTML = `<strong>${sf.name}</strong>`;

        sf.links.forEach(l=>{
          const hay = `${c.customer} ${sf.name} ${l.label} ${l.desc}`.toLowerCase();
          if (lastQuery && !hay.includes(lastQuery)) return;

          const a = document.createElement('a');
          a.className = "link";
          a.href = l.url;
          a.target = "_blank";
          a.rel = "noopener noreferrer";
          a.innerHTML = `${l.label}<span>${l.desc || ""}</span>`;

          // Cegah "#" melompat ke atas
          a.addEventListener('click', (e) => {
            if (!l.url || l.url === '#') {
              e.preventDefault();
              alert('Link belum di-set. Silakan isi URL yang benar.');
            }
          });

          sfDiv.appendChild(a);
          hits++; customerHasHit = true;
        });

        if (sfDiv.querySelector('.link')) body.appendChild(sfDiv);
      });

      // Buka otomatis saat ada pencarian; kalau tidak ada pencarian pakai state tersimpan
      const shouldOpen = lastQuery ? customerHasHit : openCustomers.has(c.customer);
      body.style.display = shouldOpen ? 'block' : 'none';
      if (shouldOpen && !lastQuery) openCustomers.add(c.customer);

      // Toggle open/close; simpan state hanya saat tidak sedang mencari
      head.addEventListener('click', ()=>{
        const nowOpen = body.style.display === 'block';
        body.style.display = nowOpen ? 'none' : 'block';
        if (!lastQuery) {
          if (nowOpen) openCustomers.delete(c.customer);
          else openCustomers.add(c.customer);
          localStorage.setItem('kensa_open', JSON.stringify([...openCustomers]));
        }
      });

      if (body.children.length > 0){
        wrap.appendChild(head);
        wrap.appendChild(body);
        elFolders.appendChild(wrap);
      }
    });

    elHit.textContent = hits ? `ヒット: ${hits}` : "該当なし";

    // Jika tidak ada query, tampilkan semua customer (folder tertutup = tampilan awal)
    if (!lastQuery) {
      [...elFolders.querySelectorAll('.folder-body')].forEach(b => b.style.display = 'none');
    }
  }
</script>
</body>
</html>
