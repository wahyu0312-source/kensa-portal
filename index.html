<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>品質管理生産技術 - 出荷状況</title>
  <style>
    body {
      margin: 0;
      font-family: "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background: linear-gradient(135deg, #f0f7ff, #e6ebf5);
      color: #0f172a;
    }
    header {
      background: #ffffffcc;
      backdrop-filter: blur(8px);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 24px;
      border-bottom: 1px solid #e5e7eb;
      position: sticky;
      top: 0;
      z-index: 100;
    }
    .brand {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .brand svg { width: 40px; height: 40px; }
    .brand-title {
      display: flex;
      flex-direction: column;
    }
    .brand-title strong { font-size: 1.2rem; }
    nav a {
      margin-left: 20px;
      color: #2563eb;
      text-decoration: none;
      font-weight: 600;
    }
    nav a:hover { text-decoration: underline; }

    main { max-width: 1200px; margin: 24px auto; padding: 0 20px; }
    h1 { margin-top: 0; }
    .status-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 16px;
      margin: 20px 0;
    }
    .card {
      background: #fff;
      border-radius: 14px;
      padding: 20px;
      box-shadow: 0 4px 12px rgba(0,0,0,.05);
      text-align: center;
    }
    .card .label { color: #64748b; }
    .card .value { font-size: 1.8rem; font-weight: bold; color: #2563eb; }

    .table-wrap {
      overflow-x: auto;
      border: 1px solid #e5e7eb;
      border-radius: 12px;
      background: #fff;
      margin-top: 20px;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      min-width: 700px;
    }
    th, td {
      padding: 10px 12px;
      border-bottom: 1px solid #e5e7eb;
      white-space: nowrap;
    }
    th { background: #f9fafb; text-align: left; color: #475569; }
    tr:nth-child(even) td { background: #f9fafb; }
    .badge {
      padding: 4px 10px;
      border-radius: 999px;
      font-size: .8rem;
      font-weight: 600;
      color: #fff;
    }
    .OK { background: #22c55e; }
    .NG { background: #ef4444; }
    .WIP { background: #f59e0b; }
    .その他 { background: #3b82f6; }
    footer {
      text-align: center;
      color: #64748b;
      padding: 20px;
      font-size: .9rem;
    }
  </style>
</head>
<body>
<header>
  <div class="brand">
    <!-- Logo -->
    <svg viewBox="0 0 64 64">
      <circle cx="32" cy="32" r="30" fill="#2563eb22"/>
      <path d="M12 34h40M12 30h40M20 18h24v6H20zM20 40h24v6H20z"
        stroke="#2563eb" stroke-width="2" fill="none" stroke-linecap="round"/>
      <circle cx="20" cy="32" r="3" fill="#2563eb"/>
      <circle cx="44" cy="32" r="3" fill="#2563eb"/>
    </svg>
    <div class="brand-title">
      <strong>品質管理生産技術</strong>
      <span>東京精密発條株式会社</span>
    </div>
  </div>
  <nav>
    <a href="./index.html"><strong>ホーム</strong></a>
    <a href="./forms.html">出荷検査成績書</a>
  </nav>
</header>

<main>
  <h1>出荷状況一覧</h1>
  <div id="status-cards" class="status-cards"></div>
  <div class="table-wrap">
    <table>
      <thead><tr id="thead"></tr></thead>
      <tbody id="tbody"></tbody>
    </table>
  </div>
</main>

<footer>
  &copy; <span id="year"></span> 東京精密発條株式会社
</footer>

<script>
document.getElementById("year").textContent = new Date().getFullYear();
const SPREADSHEET_ID = "1lYl7oYk6atnm3KqC6VwufARX3ooRyJ2VmC_xYFb4-OE";
const GID = "0"; // ganti sesuai tab (gid di URL)

async function fetchGViz() {
  const url = `https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/gviz/tq?gid=${GID}&tqx=out:json`;
  const res = await fetch(url);
  const text = await res.text();
  const json = JSON.parse(text.substr(47).slice(0,-2));
  const cols = json.table.cols.map(c => c.label);
  const rows = json.table.rows.map(r => r.c.map(c => c ? c.v : ""));
  return [cols, rows];
}

function render([cols, rows]) {
  // header
  document.getElementById("thead").innerHTML =
    cols.map(c => `<th>${c}</th>`).join("");
  // body
  const tb = document.getElementById("tbody");
  tb.innerHTML = "";
  rows.forEach(r=>{
    tb.innerHTML += "<tr>" + r.map((v,i)=>{
      if(cols[i].includes("ステータス") || cols[i].toLowerCase().includes("status")){
        let cls = "その他";
        if(/OK|良/i.test(v)) cls="OK";
        else if(/NG|不/i.test(v)) cls="NG";
        else if(/WIP|進行/i.test(v)) cls="WIP";
        return `<td><span class="badge ${cls}">${v}</span></td>`;
      }
      return `<td>${v}</td>`;
    }).join("") + "</tr>";
  });

  // status summary
  const counts = {};
  const idx = cols.findIndex(c=>c.includes("ステータス")||c.toLowerCase().includes("status"));
  if(idx>=0){
    rows.forEach(r=>{
      let k=r[idx]||"その他"; counts[k]=(counts[k]||0)+1;
    });
  }
  const sc = document.getElementById("status-cards");
  sc.innerHTML = "";
  Object.entries(counts).forEach(([k,v])=>{
    sc.innerHTML += `<div class="card"><div class="label">${k}</div><div class="value">${v}</div></div>`;
  });
}

fetchGViz().then(render).catch(e=>console.error(e));
</script>
</body>
</html>
